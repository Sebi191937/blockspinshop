<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mi Tienda Blockspin</title>
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Poppins', sans-serif;
            text-align: center;
        }
        .menu {
            margin: 30px;
        }
        .menu h2 {
            margin-bottom: 15px;
        }
        .menu button {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            border: none;
            padding: 10px 20px;
            color: white;
            margin: 5px;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
        }
        .menu button:hover {
            transform: scale(1.05);
        }
        #cart {
            margin-top: 30px;
            padding: 20px;
            background: #1e1e1e;
            border-radius: 10px;
            box-shadow: 0 0 10px #ff4b2b;
        }
        #chatbox {
            background: #1f1f1f;
            padding: 15px;
            border-radius: 10px;
            height: 300px;
            overflow-y: auto;
            margin-bottom: 10px;
            box-shadow: inset 0 0 5px #ff4b2b;
        }
        #contact {
            margin-top: 40px;
        }
        input[type="text"] {
            padding: 10px;
            width: 80%;
            border-radius: 5px;
            border: none;
            margin-bottom: 10px;
        }
        #notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #00c851;
            padding: 10px 20px;
            border-radius: 8px;
            display: none;
            color: white;
            font-weight: bold;
            z-index: 999;
        }
        #notification.error {
            background: #ff4444;
        }
    </style>
</head>
<body>

    <div id="notification"></div>

    <h1>Bienvenido a la Tienda de Chips y Armas 🔥</h1>

    <!-- Menú de compra por dinero del juego -->
    <div class="menu">
        <h2>Compra con Dinero del Juego</h2>
        <p>Recuerda tener mínimo 16.8k en mano para recibir 12k exactos.</p>
        <button onclick="addToCart('16 Chips (12k InGame)', 'Dinero Juego')">Comprar 16 Chips</button>
        <button onclick="addToCart('Arma Especial', 'Dinero Juego')">Comprar Arma</button>
    </div>

    <!-- Menú de compra por dinero real -->
    <div class="menu">
        <h2>Compra con Dinero Real</h2>
        <p>16 Chips = 1 USD | Arma = 1 USD</p>
        <button onclick="addToCart('16 Chips', 'Dinero Real')">Comprar 16 Chips</button>
        <button onclick="addToCart('Arma Especial', 'Dinero Real')">Comprar Arma</button>
    </div>

    <!-- Carrito -->
    <div id="cart">
        <h2>Carrito</h2>
        <ul id="cartItems"></ul>
    </div>

    <!-- Chat -->
    <div id="contact">
        <h2>Chat en Vivo</h2>

        <div id="chatbox"></div>

        <input type="text" id="userInput" placeholder="Escribe tu mensaje..." onkeypress="if(event.key==='Enter') sendMessage()">
        <br>
        <button onclick="sendMessage()">Enviar</button>
        <button onclick="clearChat()">Borrar Chat</button>
    </div>

    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <script>
        let userId;
        let cart = [];

        // Inicializar EmailJS
        (function() {
            emailjs.init("AQUÍ_TU_PUBLIC_KEY"); // 👈 Pega tu Public Key aquí
        })();

        function addToCart(item, metodo) {
            cart.push({ item: item, metodo: metodo });
            updateCart();
        }

        function updateCart() {
            let cartItems = document.getElementById('cartItems');
            cartItems.innerHTML = "";
            cart.forEach(producto => {
                let li = document.createElement('li');
                li.innerText = `${producto.item} - (${producto.metodo})`;
                cartItems.appendChild(li);
            });
        }

        window.onload = function() {
            if (localStorage.getItem('userId')) {
                userId = localStorage.getItem('userId');
            } else {
                userId = 'user_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('userId', userId);
            }

            if (localStorage.getItem('chatHistory_' + userId)) {
                document.getElementById('chatbox').innerHTML = localStorage.getItem('chatHistory_' + userId);
            }
        }

        function sendMessage() {
            let input = document.getElementById('userInput');
            let message = input.value.trim();
            if (message !== "") {
                let chatbox = document.getElementById('chatbox');

                let userMsg = document.createElement('div');
                userMsg.style.margin = '5px 0';
                userMsg.innerHTML = '<b>Cliente:</b> ' + message;
                chatbox.appendChild(userMsg);
                chatbox.scrollTop = chatbox.scrollHeight;
                input.value = '';

                saveChat();
                sendEmailNotification(message);

                // Respuesta automática
                setTimeout(() => {
                    let botMsg = document.createElement('div');
                    botMsg.style.margin = '5px 0';
                    botMsg.innerHTML = '<b>Vendedor:</b> Gracias por tu mensaje, pronto te responderemos.';
                    chatbox.appendChild(botMsg);
                    chatbox.scrollTop = chatbox.scrollHeight;
                    saveChat();
                }, 1000);
            }
        }

        function saveChat() {
            let chatContent = document.getElementById('chatbox').innerHTML;
            localStorage.setItem('chatHistory_' + userId, chatContent);
        }

        function clearChat() {
            if (confirm('¿Seguro que quieres borrar todo el chat?')) {
                document.getElementById('chatbox').innerHTML = '';
                localStorage.removeItem('chatHistory_' + userId);
            }
        }

        function sendEmailNotification(message) {
            emailjs.send("AQUÍ_TU_SERVICE_ID", "AQUÍ_TU_TEMPLATE_ID", {
                user_id: userId,
                user_message: message
            })
            .then(function(response) {
               console.log('Correo enviado!', response.status, response.text);
               showNotification("Mensaje enviado correctamente ✅");
            }, function(error) {
               console.log('Fallo al enviar.', error);
               showNotification("Error al enviar el mensaje ❌", true);
            });
        }

        function showNotification(texto, error = false) {
            let notif = document.getElementById('notification');
            notif.textContent = texto;
            if (error) {
                notif.classList.add('error');
            } else {
                notif.classList.remove('error');
            }
            notif.style.display = 'block';
            setTimeout(() => {
                notif.style.display = 'none';
            }, 3000);
        }
    </script>

</body>
</html>

